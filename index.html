<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Виджет: тип недели + цифровые часы</title>
  <!-- Шрифты: спокойный гротеск + моно для цифр -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: transparent;
      --rect-bg: rgba(12, 15, 23, .72);   /* тёмный полупрозрачный фон */
      --fg: rgba(243,244,246,.96);
      --muted: rgba(203,213,225,.82);
      --blue: #60a5fa;                    /* читается на тёмном */
      --red:  #f43f5e;
    }
    html, body { height:100%; margin:0; padding:0; background:var(--bg); color:var(--fg); }
    body { font: 400 16px "Outfit", Inter, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", Helvetica, Arial, ui-sans-serif, sans-serif; }

    /* Прямоугольник = весь iframe без пустот */
    .rect{ width:100%; height:100%; box-sizing:border-box; background:var(--rect-bg);
           display:grid; place-items:center; border:none; border-radius:0; box-shadow:none; padding:0 18px; 
           -webkit-backdrop-filter: saturate(140%) blur(2px); backdrop-filter: saturate(140%) blur(2px); }

    /* Сетка контента: день недели сверху, часы по центру, строка снизу */
    .wrap{ width:100%; height:100%; box-sizing:border-box; display:grid; grid-template-rows: auto 1fr auto; gap: 10px; }

    .weekday{ text-align:center; color:var(--muted); font-weight:500; letter-spacing:.2px; font-size: clamp(14px, 1.6vw, 18px); }

    .clock{ display:grid; place-items:center; }
    .time{
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-feature-settings: "tnum" 1, "ss01" 1;  /* табличные цифры */
      font-variant-numeric: tabular-nums;
      line-height: 1; font-weight:500; letter-spacing: .02em;
      /* Подгоняем размер под высоту виджета: крупные цифровые часы */
      font-size: clamp(36px, 14vh, 110px);
    }

    .line{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; text-align:center; line-height:1; 
           font-weight:400; letter-spacing:.15px; font-size: clamp(15px, 1.8vw, 18px); }
    .sep{ opacity:.8; }
    .tri{ font-size:1.05em; }
    .tri.blue{ color: var(--blue); }
    .tri.red{  color: var(--red); }
  </style>
</head>
<body>
  <div class="rect">
    <div class="wrap">
      <div id="weekday" class="weekday">—</div>
      <div class="clock"><div id="time" class="time" aria-live="polite">00:00:00</div></div>
      <div id="line" class="line" aria-live="polite">—</div>
    </div>
  </div>

  <script>
    // —— Параметры ——
    const qs = new URLSearchParams(location.search);
    const START = qs.get('start') || '2025-09-01'; // начало 1-й недели (лучше понедельник)

    // —— Утилиты ——
    const pad2 = n => String(n).padStart(2,'0');
    function toLocalDate(ymd){ const [y,m,d] = (ymd||'').split('-').map(Number); return new Date(y||1970, (m||1)-1, d||1, 0,0,0,0); }
    function mondayOf(d){ const x=new Date(d.getFullYear(), d.getMonth(), d.getDate()); const day=(x.getDay()+6)%7; x.setDate(x.getDate()-day); x.setHours(0,0,0,0); return x; }
    function weekIndex(start, today){ const s=mondayOf(start), t=mondayOf(today); const days=Math.round((t-s)/86400000); return Math.floor(days/7)+1; }

    function render(){
      const now = new Date();

      // День недели (сверху)
      const weekday = new Intl.DateTimeFormat('ru-RU',{weekday:'long'}).format(now);
      document.getElementById('weekday').textContent = weekday;

      // Цифровые часы по центру
      const hh = pad2(now.getHours());
      const mm = pad2(now.getMinutes());
      const ss = pad2(now.getSeconds());
      document.getElementById('time').textContent = `${hh}:${mm}:${ss}`;

      // Строка снизу: дата + тип недели
      const dateStr = `${pad2(now.getDate())}.${pad2(now.getMonth()+1)}.${pad2(now.getFullYear()%100)}`;
      const start = toLocalDate(START);
      let w = weekIndex(start, now); if(!isFinite(w) || w<1) w=1;
      const even = (w%2===0);
      const side = even ? 'нижняя' : 'верхняя';
      const parity = even ? 'четная' : 'нечетная'; // без ё, как в примере
      const tri = even ? '▼' : '▲';
      const triClass = even ? 'blue' : 'red';

      document.getElementById('line').innerHTML =
        `${dateStr}&nbsp;&nbsp;<span class="sep">|</span>&nbsp;&nbsp;${side}, ${parity}, <span class="tri ${triClass}">${tri}</span>`;
    }

    function schedule(){
      const now = new Date();
      render();
      setTimeout(schedule, 1000 - now.getMilliseconds());
    }

    // Пересчет при возврате к вкладке/странице
    document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) render(); });

    // Старт
    schedule();
  </script>
</body>
</html>
